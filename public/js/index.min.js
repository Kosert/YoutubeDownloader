window.onload=function(){function a(){if(''===n.value)p='',m();else if(''!==n.value&&p!==n.value){k(),p=n.value;var x='url='+p;xmlhttp=new XMLHttpRequest,xmlhttp.open('POST','/youtube/validateURL',!0),xmlhttp.onreadystatechange=function(){4==xmlhttp.readyState&&200==xmlhttp.status&&('true'===xmlhttp.responseText?l():m())},xmlhttp.send(x)}}function b(){setTimeout(a,0)}function d(x){var y=x.encoding?x.encoding:x.audioEncoding,z=x.container,A=x.encoding?x.resolution+(x.fps?' '+x.fps+'fps':''):x.audioBitrate+' kbps';return y+' | '+z+' | '+A}function e(x,y){for(f of y){var z=x.tBodies[0],A=z.insertRow(z.rows.length);f.encoding&&(A.insertCell().innerHTML=f.encoding),f.audioEncoding&&(A.insertCell().innerHTML=f.audioEncoding),A.insertCell().innerHTML='<b>'+f.container+'</b>',A.insertCell().innerHTML=f.encoding?f.resolution+(f.fps?' '+f.fps+'fps':''):f.audioBitrate+' kbps';var B=document.createElement('a');B.href=f.url,B.download=document.getElementById('title').innerText,B.title='Click here to download',B.classList.add('btn','btn-outline-info');var C=document.createTextNode('Download');B.appendChild(C),A.insertCell().appendChild(B)}}function g(x){var y=x.getElementsByTagName('tbody')[0],z=document.createElement('tbody');x.replaceChild(z,y)}function h(){var x=s[u.selectedIndex],y=t[v.selectedIndex],z=document.getElementById('convert'),A=!0,B=!0;('webm'===x.container||'webm'===y.container)&&(A=!1),('webm'!==x.container||'webm'!==y.container)&&(B=!1);var C=document.getElementById('dummy-container');A?(C.value='mp4',z.value='Convert to MP4'):B?(C.value='webm',z.value='Convert to WEBM'):(C.value='mkv',z.value='Convert to MKV')}function j(x){for(var C,y=x+'=',z=decodeURIComponent(document.cookie),A=z.split(';'),B=0;B<A.length;B++){for(C=A[B];' '==C.charAt(0);)C=C.substring(1);if(0==C.indexOf(y))return C.substring(y.length,C.length)}return''}function k(){n.classList.add('loading'),n.classList.remove('is-valid'),n.classList.remove('is-invalid'),o.classList.add('btn-secondary'),o.classList.remove('btn-primary'),o.disabled=!0}function l(){n.classList.remove('loading'),n.classList.add('is-valid'),o.classList.add('btn-primary'),o.classList.remove('btn-secondary'),o.disabled=!1}function m(){n.classList.remove('loading'),n.classList.add('is-invalid'),o.classList.add('btn-secondary'),o.classList.remove('btn-primary'),o.disabled=!0}var n=document.getElementById('input-url'),o=document.getElementById('button-download'),p='',q=document.getElementById('div-error');-1<window.location.href.indexOf('error')&&(q.hidden=!1),n.addEventListener('keyup',b),n.addEventListener('paste',b);var r=[],s=[],t=[],u=document.getElementById('video-select'),v=document.getElementById('audio-select');u.addEventListener('change',function(){h()}),v.addEventListener('change',function(){h()});var w=document.getElementById('convert');w.addEventListener('click',function(){w.disabled=!0,document.getElementById('div-convert-loading').hidden=!1,document.getElementById('form-custom').hidden=!0;var x=document.getElementById('progress-convert');x.classList.add('progress-bar-striped'),x.classList.remove('bg-success'),x.innerText='Converting...';var y=setInterval(function(){var z=j('downloadComplete');'true'===z&&(x.classList.add('bg-success'),x.classList.remove('progress-bar-striped'),x.innerText='Download started',document.cookie='downloadComplete=; Max-Age=-99999999;',clearInterval(y))});document.getElementById('form-custom').submit()}),o.addEventListener('click',function(){q.hidden=!0;var x=document.getElementById('div-loading');x.hidden=!1;var y=document.getElementById('div-info');y.hidden=!0;var z=document.getElementById('div-custom');z.hidden=!0;var A=document.getElementById('div-tracks');A.hidden=!0;var B=document.getElementById('div-fulls');B.hidden=!0;var C=document.getElementById('fulls'),D=document.getElementById('videoOnly'),E=document.getElementById('audioOnly');for(g(C),g(D),g(E),document.getElementById('div-convert-loading').hidden=!0,document.getElementById('form-custom').hidden=!1;0<u.options.length;)u.remove(0);for(;0<v.options.length;)v.remove(0);r=[],s=[],t=[];var F='url='+p;xmlhttp=new XMLHttpRequest,xmlhttp.open('POST','/youtube/getInfo',!0),xmlhttp.onreadystatechange=function(){if(x.hidden=!0,4==xmlhttp.readyState&&200==xmlhttp.status){var G=JSON.parse(xmlhttp.responseText);if(G.error)q.hidden=!1,q.children[0].innerText='Error: '+G.error;else{for(f of G.formats)if(f.container)if(f.encoding&&f.audioEncoding)r.push(f);else if(f.encoding&&!f.audioEncoding){s.push(f);var H=document.createElement('option');H.value=f.itag,H.text=d(f),u.add(H)}else{t.push(f);var H=document.createElement('option');H.value=f.itag,H.text=d(f),v.add(H)}document.getElementById('title').innerText=G.title,document.getElementById('description').innerText='Uploaded by: '+G.author,document.getElementById('thumbnail').src=G.thumb,document.getElementById('dummy-name').value=G.title,document.getElementById('dummy-url').value=G.url,y.hidden=!1,B.hidden=!1,A.hidden=!1,w.disabled=!1,z.hidden=!1,e(C,r),e(D,s),e(E,t),h()}}},xmlhttp.send(F)}),''!==n.value&&b(),console.log('Init completed.')};