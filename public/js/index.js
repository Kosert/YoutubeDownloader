window.onload=function(){function e(){if(""===c.value)return h="",void s();var e;if(e=(c.value.startsWith("http"),"https://"+c.value),!isValidUrl(e))return h=c.value,void s();if(""!==c.value&&h!==c.value){h=c.value;var t="url="+h;xmlhttp=new XMLHttpRequest,xmlhttp.open("POST","/validateURL",!0),xmlhttp.onreadystatechange=function(){4==xmlhttp.readyState&&200==xmlhttp.status&&("true"===xmlhttp.responseText?r():s())},xmlhttp.send(t)}}function t(){a(),clearTimeout(v),v=setTimeout(e,500)}function n(e){var t=e.codecs.split(".")[0],n=e.container,d=e.width?e.qualityLabel+(e.fps?" "+e.fps+"fps":""):e.audioBitrate+" kbps";return t+" | "+n+" | "+d}function d(e,t){for(f of t){var n=e.tBodies[0],d=n.insertRow(n.rows.length);f.codecs.split(",")[0]&&(d.insertCell().innerHTML=f.codecs.split(",")[0].split(".")[0]),f.codecs.split(",")[1]&&(d.insertCell().innerHTML=f.codecs.split(",")[1].split(".")[0]),d.insertCell().innerHTML="<b>"+f.container+"</b>",d.insertCell().innerHTML=f.width?f.qualityLabel+(f.fps?" "+f.fps+"fps":""):f.audioBitrate+" kbps";var i=document.createElement("a");i.href=f.url,i.download=document.getElementById("title").innerText,i.title="Click here to download",i.classList.add("btn","btn-info");var o=document.createTextNode("Download");i.appendChild(o);const t=d.insertCell();t.classList.add("align-middle"),t.appendChild(i)}}function i(e){var t=e.getElementsByTagName("tbody")[0],n=document.createElement("tbody");e.replaceChild(n,t)}function o(){var e=y[b.selectedIndex],t=E[B.selectedIndex],n=document.getElementById("convert"),d=!0,i=!0;"webm"!==e.container&&"webm"!==t.container||(d=!1),"webm"===e.container&&"webm"===t.container||(i=!1);var o=document.getElementById("dummy-container");d?(o.value="mp4",n.value="Convert to MP4"):i?(o.value="webm",n.value="Convert to WEBM"):(o.value="mkv",n.value="Convert to MKV")}function l(e){for(var t=e+"=",n=decodeURIComponent(document.cookie),d=n.split(";"),i=0;i<d.length;i++){for(var o=d[i];" "==o.charAt(0);)o=o.substring(1);if(0==o.indexOf(t))return o.substring(t.length,o.length)}return""}function a(){u.hidden=!1,c.style.width="calc(100% - 50px)",c.classList.remove("valid"),c.classList.remove("invalid"),m.classList.add("btn-secondary"),m.classList.remove("btn-primary"),m.disabled=!0}function r(){u.hidden=!0,c.style.width="100%",c.classList.add("valid"),m.classList.add("btn-primary"),m.classList.remove("btn-secondary"),m.disabled=!1}function s(){u.hidden=!0,c.style.width="100%",c.classList.add("invalid"),m.classList.add("btn-secondary"),m.classList.remove("btn-primary"),m.disabled=!0}var c=document.getElementById("input-url"),m=document.getElementById("button-download");const u=this.document.getElementById("loader");var v,h="",p=document.getElementById("div-error");window.location.href.indexOf("error")>-1&&(p.hidden=!1),c.addEventListener("keyup",t),c.addEventListener("paste",t);var g=[],y=[],E=[],b=document.getElementById("video-select"),B=document.getElementById("audio-select");b.addEventListener("change",function(){o()}),B.addEventListener("change",function(){o()});var I=document.getElementById("convert");I.addEventListener("click",function(){I.disabled=!0,document.getElementById("div-convert-loading").hidden=!1,document.getElementById("form-custom").hidden=!0;var e=document.getElementById("progress-convert");e.classList.add("progress-bar-striped"),e.classList.remove("bg-success"),e.innerText="Converting...";var t=setInterval(function(){var n=l("downloadComplete");"true"===n&&(e.classList.add("bg-success"),e.classList.remove("progress-bar-striped"),e.innerText="Download started",document.cookie="downloadComplete=; Max-Age=-99999999;",clearInterval(t))});document.getElementById("form-custom").submit()}),m.addEventListener("click",function(){p.hidden=!0;var e=document.getElementById("div-loading");e.hidden=!1;var t=document.getElementById("div-info");t.hidden=!0;var l=document.getElementById("div-custom");l.hidden=!0;var a=document.getElementById("div-tracks");a.hidden=!0;var r=document.getElementById("div-fulls");r.hidden=!0;var s=document.getElementById("fulls"),c=document.getElementById("videoOnly"),m=document.getElementById("audioOnly");for(i(s),i(c),i(m),document.getElementById("div-convert-loading").hidden=!0,document.getElementById("form-custom").hidden=!1;b.options.length>0;)b.remove(0);for(;B.options.length>0;)B.remove(0);g=[],y=[],E=[];var u="url="+h;xmlhttp=new XMLHttpRequest,xmlhttp.open("POST","/getInfo",!0),xmlhttp.onreadystatechange=function(){if(e.hidden=!0,4==xmlhttp.readyState&&200==xmlhttp.status){var i=JSON.parse(xmlhttp.responseText);if(i.error)p.hidden=!1,p.children[0].innerText="Error: "+i.error;else{for(f of i.formats)if(f.container)if(f.width&&f.audioBitrate)g.push(f);else if(f.width&&!f.audioBitrate){y.push(f);var u=document.createElement("option");u.value=f.itag,u.text=n(f),b.add(u)}else{E.push(f);u=document.createElement("option");u.value=f.itag,u.text=n(f),B.add(u)}document.getElementById("title").innerText=i.title,document.getElementById("description").innerText="Uploaded by: "+i.author,document.getElementById("thumbnail").src=i.thumb,document.getElementById("dummy-name").value=i.title,document.getElementById("dummy-url").value=i.url,t.hidden=!1,r.hidden=!1,a.hidden=!1,I.disabled=!1,l.hidden=!1,d(s,g),d(c,y),d(m,E),o()}}},xmlhttp.send(u)}),""!==c.value&&t(),console.log("Init completed.")};const isValidUrl=e=>{try{return new URL(e),!0}catch(e){return!1}};